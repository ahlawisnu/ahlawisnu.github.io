<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Miku Prompt Builder</title>

<style>
/* ===========================
   MATERIAL 3 + MIKU GAME THEME
=========================== */

:root{
--bg:#070b14;
--surface:#0f1624;
--card:#172036;
--primary:#3df2e6;
--secondary:#8fd7ff;
--danger:#ff5b7c;
--text:#eaf6ff;
--muted:#93a4c5;
--radius:18px;
--glow:0 0 14px #3df2e6;
}

*{
box-sizing:border-box;
font-family:system-ui,-apple-system,Segoe UI,Roboto;
}

body{
margin:0;
padding:16px;
background:
radial-gradient(circle at top,#112040,#05070d);
color:var(--text);
}

/* ========================= */

header{
text-align:center;
margin-bottom:18px;
}

h1{
margin:0;
color:var(--primary);
text-shadow:var(--glow);
}

/* ========================= */

.app{
display:grid;
grid-template-columns:1fr 1fr;
gap:16px;
}

@media(max-width:900px){
.app{
grid-template-columns:1fr;
}
}

/* ========================= */

.panel{
background:var(--surface);
border-radius:var(--radius);
padding:16px;
box-shadow:0 0 0 1px #1c2b4a inset;
}

/* ========================= */

.toolbar{
display:flex;
flex-wrap:wrap;
gap:10px;
margin-bottom:12px;
}

button{
border:none;
padding:10px 18px;
border-radius:999px;
cursor:pointer;
font-weight:600;
color:#001;
background:
linear-gradient(135deg,var(--primary),var(--secondary));
box-shadow:var(--glow);
}

button.secondary{
background:#243256;
color:var(--text);
box-shadow:none;
}

button.danger{
background:var(--danger);
color:white;
box-shadow:none;
}

/* ========================= */

.row{
display:flex;
gap:8px;
flex-wrap:wrap;
margin-bottom:8px;
}

input,select{
flex:1;
min-width:120px;
background:#0b1220;
border:1px solid #2a3a5f;
border-radius:10px;
padding:8px 10px;
color:var(--text);
}

input:focus,select:focus{
outline:none;
border-color:var(--primary);
box-shadow:0 0 0 2px #3df2e640;
}

/* ========================= */

.child{
background:var(--card);
border-radius:14px;
padding:10px;
margin-top:8px;
margin-left:18px;
border-left:2px solid var(--primary);
}

/* ========================= */

textarea{
width:100%;
height:260px;
background:#05080f;
border-radius:14px;
border:1px solid #2a3a5f;
padding:12px;
color:#46ffe0;
font-family:monospace;
}

/* ========================= */

.section-title{
color:var(--secondary);
margin:10px 0;
}

/* ========================= */
</style>
</head>

<body>

<header>
<h1>ðŸŽ¤ Miku Prompt Builder</h1>
<p>Material Design 3 â€¢ Game Style â€¢ Escaped JSON Generator</p>
</header>

<div class="app">

<!-- LEFT PANEL -->
<div class="panel">

<h3 class="section-title">Outer Keys</h3>
<div id="outerFields"></div>
<button onclick="addOuter()">âž• Add Outer Key</button>

<h3 class="section-title">Inner Structure (action_input)</h3>
<div id="innerTree"></div>
<button onclick="addInner(innerTree)">âž• Add Field</button>

<h3 class="section-title">Templates</h3>
<div class="toolbar">
<button class="secondary" onclick="loadTemplate('image')">Image To Text</button>
<button class="secondary" onclick="loadTemplate('txt2img')">Text To Image</button>
</div>

</div>

<!-- RIGHT PANEL -->
<div class="panel">

<h3 class="section-title">Output</h3>

<div class="toolbar">
<button onclick="copyOut()">ðŸ“‹ Copy</button>
<button onclick="exportTXT()">â¬‡ Export TXT</button>
</div>

<textarea id="output"></textarea>

</div>

</div>

<script>
const outerFields=document.getElementById("outerFields");
const innerTree=document.getElementById("innerTree");

/* ========== OUTER ========== */

function addOuter(k="",v=""){
const r=document.createElement("div");
r.className="row";
r.innerHTML=`
<input class="ok" placeholder="key" value="${k}">
<input class="ov" placeholder="value" value="${v}">
<button class="danger" onclick="this.parentElement.remove();update()">âœ–</button>
`;
outerFields.appendChild(r);
update();
}

addOuter("action","image_to_text");

/* ========== INNER NODE ========== */

function createInner(){
const d=document.createElement("div");
d.className="child";
d.innerHTML=`
<div class="row">
<input class="ik" placeholder="key">
<select class="it">
<option value="value">value</option>
<option value="array">array</option>
<option value="object">object</option>
</select>
<input class="iv" placeholder="value / a,b,c">
<button onclick="addInner(this.parentElement.nextElementSibling)">ï¼‹</button>
<button class="danger" onclick="this.closest('.child').remove();update()">âœ–</button>
</div>
<div></div>
`;
return d;
}

function addInner(parent){
parent.appendChild(createInner());
update();
}

/* ========== BUILD INNER ========== */

function buildInner(container){
let obj={};
container.querySelectorAll(":scope>.child").forEach(n=>{
const k=n.querySelector(".ik").value;
const t=n.querySelector(".it").value;
const v=n.querySelector(".iv").value;
const child=n.children[1];
if(!k) return;

if(t==="value") obj[k]=v;
if(t==="array")
 obj[k]=v.split(",").map(x=>x.trim()).filter(Boolean);
if(t==="object")
 obj[k]=buildInner(child);
});
return obj;
}

/* ========== UPDATE OUTPUT ========== */

function update(){
let outer={};
document.querySelectorAll(".ok").forEach((k,i)=>{
const key=k.value;
const val=document.querySelectorAll(".ov")[i].value;
if(key) outer[key]=val;
});

const innerObj=buildInner(innerTree);
let escaped=JSON.stringify(innerObj).replace(/"/g,'\"');
outer["action_input"]=`{ ${escaped.slice(1,-1)} }`;

output.value=JSON.stringify(outer,null,2);
}

document.addEventListener("input",update);
document.addEventListener("change",update);

/* ========== COPY / EXPORT ========== */

function copyOut(){
navigator.clipboard.writeText(output.value);
alert("Copied!");
}

function exportTXT(){
const b=new Blob([output.value],{type:"text/plain"});
const a=document.createElement("a");
a.href=URL.createObjectURL(b);
a.download="prompt.txt";
a.click();
}

/* ========== TEMPLATE ========== */

function loadTemplate(type){
innerTree.innerHTML="";

if(type==="image"){
addInner(innerTree);
innerTree.querySelector(".ik").value="taks";
innerTree.querySelector(".iv").value="buatkan prompt lengkap berdasarkan gambar";

addInner(innerTree);
innerTree.querySelectorAll(".ik")[1].value="output";
innerTree.querySelectorAll(".iv")[1].value="Prompt lengkap satu paragraf";

addInner(innerTree);
innerTree.querySelectorAll(".ik")[2].value="Target";
innerTree.querySelectorAll(".iv")[2].value="Prompt Gemini AI";
}

if(type==="txt2img"){
addInner(innerTree);
innerTree.querySelector(".ik").value="prompt";
innerTree.querySelector(".iv").value="beautiful girl";

addInner(innerTree);
innerTree.querySelectorAll(".ik")[1].value="ratio";
innerTree.querySelectorAll(".iv")[1].value="9:16";
}

update();
}
</script>

</body>
</html>
