<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Advanced Escaped JSON Prompt Builder</title>

<style>
body{
background:#0b0f18;
color:#eaf6ff;
font-family:Arial;
padding:20px;
}

h2{color:#39f5e4;}

.panel{
background:#161c2f;
padding:15px;
border-radius:12px;
margin-bottom:16px;
}

.row{
display:flex;
gap:8px;
margin-bottom:8px;
flex-wrap:wrap;
}

input,select{
padding:6px;
border-radius:6px;
border:none;
background:#0f1526;
color:white;
flex:1;
}

button{
background:#39f5e4;
border:none;
padding:6px 14px;
border-radius:999px;
cursor:pointer;
font-weight:bold;
}

button.secondary{
background:#27324a;
color:white;
}

button.danger{
background:#ff5c7c;
color:white;
}

.child{
margin-left:20px;
border-left:2px solid #2a3555;
padding-left:10px;
}

textarea{
width:100%;
height:260px;
background:#05080f;
color:#00ffd5;
border:none;
padding:12px;
border-radius:10px;
font-family:monospace;
}
</style>
</head>

<body>

<h2>Outer Keys</h2>
<div class="panel" id="outerFields"></div>
<button onclick="addOuter()">âž• Add Outer</button>

<h2>Inner Structure (action_input)</h2>
<div class="panel" id="innerTree"></div>
<button onclick="addInner(innerTree)">âž• Add Inner Field</button>

<h2>Templates</h2>
<button class="secondary" onclick="loadTemplate('image')">Image To Text</button>
<button class="secondary" onclick="loadTemplate('txt2img')">Text To Image</button>

<h2>Output</h2>
<button onclick="copyOut()">ðŸ“‹ Copy</button>
<button onclick="exportTXT()">â¬‡ Export TXT</button>
<textarea id="output"></textarea>

<script>
const outerFields=document.getElementById("outerFields");
const innerTree=document.getElementById("innerTree");

/* ---------------- OUTER ---------------- */

function addOuter(k="",v=""){
const r=document.createElement("div");
r.className="row";
r.innerHTML=`
<input class="ok" placeholder="key" value="${k}">
<input class="ov" placeholder="value" value="${v}">
<button class="danger" onclick="this.parentElement.remove();update()">âœ–</button>
`;
outerFields.appendChild(r);
update();
}

addOuter("action","image_to_text");

/* ---------------- INNER NODE ---------------- */

function createInner(){
const d=document.createElement("div");
d.className="child";
d.innerHTML=`
<div class="row">
<input class="ik" placeholder="key">
<select class="it">
<option value="value">value</option>
<option value="array">array</option>
<option value="object">object</option>
</select>
<input class="iv" placeholder="value / a,b,c">
<button onclick="addInner(this.parentElement.nextElementSibling)">ï¼‹</button>
<button class="danger" onclick="this.closest('.child').remove();update()">âœ–</button>
</div>
<div></div>
`;
return d;
}

function addInner(parent){
parent.appendChild(createInner());
update();
}

/* ---------------- BUILD INNER ---------------- */

function buildInner(container){
let obj={};
container.querySelectorAll(":scope>.child").forEach(n=>{
const k=n.querySelector(".ik").value;
const type=n.querySelector(".it").value;
const v=n.querySelector(".iv").value;
const child=n.children[1];
if(!k) return;

if(type==="value") obj[k]=v;
if(type==="array")
 obj[k]=v.split(",").map(x=>x.trim()).filter(Boolean);
if(type==="object")
 obj[k]=buildInner(child);
});
return obj;
}

/* ---------------- UPDATE ---------------- */

function update(){
let outer={};
document.querySelectorAll(".ok").forEach((k,i)=>{
const key=k.value;
const val=document.querySelectorAll(".ov")[i].value;
if(key) outer[key]=val;
});

const innerObj=buildInner(innerTree);
let escaped=JSON.stringify(innerObj).replace(/"/g,'\\"');

outer["action_input"]=`{ ${escaped.slice(1,-1)} }`;

document.getElementById("output").value=
JSON.stringify(outer,null,2);
}

document.addEventListener("input",update);
document.addEventListener("change",update);

/* ---------------- COPY / EXPORT ---------------- */

function copyOut(){
navigator.clipboard.writeText(output.value);
alert("Copied!");
}

function exportTXT(){
const b=new Blob([output.value],{type:"text/plain"});
const a=document.createElement("a");
a.href=URL.createObjectURL(b);
a.download="prompt.txt";
a.click();
}

/* ---------------- TEMPLATE ---------------- */

function loadTemplate(type){
innerTree.innerHTML="";
if(type==="image"){
addInner(innerTree);
innerTree.querySelector(".ik").value="taks";
innerTree.querySelector(".iv").value="buatkan prompt lengkap berdasarkan gambar";

addInner(innerTree);
innerTree.querySelectorAll(".ik")[1].value="output";
innerTree.querySelectorAll(".iv")[1].value="Prompt lengkap dalam satu paragraf";

addInner(innerTree);
innerTree.querySelectorAll(".ik")[2].value="Target";
innerTree.querySelectorAll(".iv")[2].value="Prompt Gemini AI";
}
if(type==="txt2img"){
addInner(innerTree);
innerTree.querySelector(".ik").value="prompt";
innerTree.querySelector(".iv").value="beautiful girl";

addInner(innerTree);
innerTree.querySelectorAll(".ik")[1].value="ratio";
innerTree.querySelectorAll(".iv")[1].value="9:16";
}
update();
}
</script>

</body>
</html>
